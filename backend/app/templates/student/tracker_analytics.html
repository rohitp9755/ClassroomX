{% extends "base.html" %}
{% block title %}Study Analytics â€” ClassroomX{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold">Study Analytics</h1>
    <a href="/student/tracker" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Back to Tracker</a>
  </div>

  <!-- Weekly Study Time Chart -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Weekly Study Time (Last 7 Days)</h2>
    <div class="h-64 flex items-end gap-2">
      {% set max_hours = ([4] + (chart_data | map(attribute='hours') | list)) | max %}
      {% for day_data in chart_data %}
        {% set hours = day_data.hours %}
        {% set height_pct = (hours / max_hours * 100) if max_hours > 0 else 0 %}
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-gray-200 rounded-t relative" style="height: 200px;">
            <div class="absolute bottom-0 left-0 right-0 bg-blue-500 rounded-t transition-all" style="height: {{ height_pct }}%"></div>
            <div class="absolute -top-6 left-0 right-0 text-xs text-gray-600 text-center">
              {% if hours > 0 %}{{ '%.1f' | format(hours) }}h{% else %}0h{% endif %}
            </div>
          </div>
          <div class="mt-2 text-xs text-gray-600 text-center transform -rotate-45 origin-left" style="width: 50px;">{{ day_data.day_name }}</div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Project Progress Stats -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Project Progress</h2>
    <div class="space-y-4">
      {% for stat in project_stats %}
      <div>
        <div class="flex justify-between items-center mb-2">
          <span class="font-medium">{{ stat.name }}</span>
          <span class="text-sm text-gray-600">{{ stat.completed_goals }}/{{ stat.total_goals }} goals</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div class="bg-blue-500 h-3 rounded-full transition-all" style="width: {{ stat.progress }}%"></div>
        </div>
        <div class="text-xs text-gray-500 mt-1">{{ '%.1f' | format(stat.progress) }}% complete</div>
      </div>
      {% else %}
      <p class="text-gray-500 text-center py-4">No projects yet. Create projects to see analytics.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Study Time by Project -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4">Study Time by Project</h2>
    <div class="space-y-3">
      {% for project in projects %}
        {% set project_time = project.goals | sum(attribute='total_study_time') %}
        {% set hours = (project_time // 3600) %}
        {% set minutes = ((project_time % 3600) // 60) %}
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 rounded" style="background-color: {{ project.color }}"></div>
            <span class="font-medium">{{ project.name }}</span>
          </div>
          <span class="text-gray-600">{{ hours }}h {{ minutes }}m</span>
        </div>
      {% else %}
      <p class="text-gray-500 text-center py-4">No projects yet.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

